@page "/UserPage"
@using BestMovies.Models
@using BestMovies.Data.CustomServices
@using System.Security.Claims
@using BestMovies.DataAccess


@inject IUserService UserService
@inject IUserData UserData

@if (_loading)
{
    <p>
        <em>Loading...</em>
    </p>
}
else
{
    <MudGrid href="@_currentUser">
        <MudItem xs="12" md="6">
            <MudCard>
                <MudCardContent>
                    <h3>User Details</h3>
                    <!-- User information -->
                    <p>Name: John Doe</p>
                    <p>Email: john.doe@example.com</p>
                    <p>Age: 30</p>
                </MudCardContent>
            </MudCard>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudCard>
                <MudCardContent>
                    <div style="border: 1px solid #ccc; padding: 10px;">
                        <h3>Movie List</h3>
                        <!-- Movie list -->
                        @if (_movies != null)
                        {
                            <ul>
                                @foreach (var movie in _movies)
                                {
                                    <li>@movie.Title</li>
                                }
                            </ul>
                        }
                        else
                        {
                            <p>No movies available.</p>
                        }
                    </div>
                </MudCardContent>
            </MudCard>
            <MudCard style="margin-top: 20px;">
                <MudCardContent>
                    <div style="border: 1px solid #ccc; padding: 10px;">
                        <h3>Fan Movie List</h3>
                        <!-- Fan movie list -->
                        @if (_fanMovies != null)
                        {
                            <ul>
                                @foreach (var fanMovie in _fanMovies)
                                {
                                    <li>@fanMovie.Description</li>
                                }
                            </ul>
                        }
                        else
                        {
                            <p>No fan movies available.</p>
                        }
                    </div>

                    @if (_currentUser.Id.Equals(_userOfPage.Id))
                    {
                        <MudButton Color="Color.Primary" Variant="Variant.Filled">Create Fan Movie</MudButton>
                    }

                </MudCardContent>
            </MudCard>

        </MudItem>
    </MudGrid>
}

@code {

    bool _loading = true;
    
    User? _userOfPage;
    User? _currentUser;
    
    List<FanMovie>? _fanMovies;
    List<Movie>? _movies;

    protected override async Task OnInitializedAsync()
    {
        
        // how to get the selected user
        _userOfPage = UserService.GetCurrentUser();
        
        _currentUser = UserService.GetCurrentUser();
        Console.WriteLine(_currentUser?.Id);
        Console.WriteLine(_userOfPage?.Id);
        if(_userOfPage == null) return;
        _loading = false;
    }
    
    
     
    
    
}